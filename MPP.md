# Многопоточное программирование

## Введение и мотивация

### Зачем нам это?

Все вычислительные машины - многоядерные (от веба до android). Закон Мура и "The free lunch is over": частота ядра стабилизировалась с 2005 года, 
рост производительности ядер начала меньше расти (не exp). Решение? 2005 год - начало эпохи многопоточности!!!

Масштабирование: с ростом кол-ва ядер скорость растет не пропорционально. 
Закон Амдала: ускорение кода S = 1 / (1 - P + P/N), где N - число потоков, P - доля параллельного кода. 

У параллелизма на уровне инструкций есть предел -> ПарПрог

### Мультипроцессорность

Симметричная мультипроцессорность (SMP) - Два (или больше) ядра, на каждый свой поток. 
Узкое место - синхронизация большого числа вычислений (например, проигрыш в хешах)

Одновременная многозадачность (SMT) - два (или более) потока выполняется на одном вычислительном ядре. Для программиста выглядит как SMP :/

Ассиметричный доступ к памяти (NUMA): Память1 <-> CPU1 <-> CPU2 <-> Память2 (чтобы обратиться к памяти, нужно задействовать определнный процессор.
Модель программирования такая же, что и в SMP - общая память.

### Операционные системы

Типы:
- Однозначные
- Система с пакетнымм заданиями (batch processing). Процессы выполняются пакетами, поочередно
- Многозадачные / с разделением времени.
  - Кооперативная многозадачность. Выполняет инструкции с того терминала, где уже написана инструкция.
  - Вытесняющая многозадачность. Твой код может быть вытеснен в произвольный момент
  
### Основные понятия
- Процесс - владеет памятью и ресурсами. ОС создают иллюзию, что у процесса есть своя отдельная машина, у которой много ядер.
- Поток - контекст исполнения внутри процесса
  - В одном процессе может быть несколько потоков
  - Все потоки работают с общей памятью процесса
 
### Модели программирования
- Однопоточное / однозадачное
- Многозадачное
  - Модель с общей памятью. Она и будет рассмотрена в этом курсе
  - Модель с передачей сообщений (распределенное сообщение)
  
### Модель с общей памятью
#### Общие объекты 
- Потоки выполняют операции над общими объектами
- Не важны операции внутри потоков
- Важна только коммуникация между потоками
- Единственный тип коммуникации между потоками - работа с общими объектами
#### Общие переменные
- Это простейший тип общения
  - Есть значения определенного типа
  - Есть read and write
- Это базовые строительные блоки
- Хорошая абстракция
